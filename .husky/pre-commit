# =============================================================================
# Pre-commit Hook: Lint + Format
# =============================================================================
# Runs before each commit to ensure code quality

echo "ğŸ” Running pre-commit checks..."

# Run lint-staged for incremental linting
npx lint-staged

# Check if backend has changes
if git diff --cached --name-only | grep -q "^backend/"; then
  echo "ğŸ“ Linting backend code..."
  cd backend && npm run lint --if-present || {
    echo "âŒ Backend linting failed. Please fix errors before committing."
    exit 1
  }
  cd ..
fi

# Check if frontend has changes
if git diff --cached --name-only | grep -q "^frontend/"; then
  echo "ğŸ“ Linting frontend code..."
  cd frontend && npm run lint --if-present || {
    echo "âŒ Frontend linting failed. Please fix errors before committing."
    exit 1
  }
  cd ..
fi

echo "âœ… Pre-commit checks passed!"
