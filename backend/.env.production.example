# =============================================================================
# RAG Platform - PRODUCTION Environment Configuration
# =============================================================================
# Copy this file to .env for production deployments.
# Uses production-grade managed services with full security hardening.
#
# SECURITY CHECKLIST before deploying:
# [ ] All secrets are unique and cryptographically secure
# [ ] MongoDB has authentication enabled
# [ ] Redis has password protection
# [ ] HTTPS is enforced everywhere
# [ ] CORS is restricted to exact domains
# [ ] Rate limiting is enabled
# [ ] Logging excludes sensitive data
# =============================================================================

# Server Configuration
PORT=3007
NODE_ENV=production

# =============================================================================
# MongoDB Configuration (Atlas - Production Cluster)
# =============================================================================
# Use M10+ cluster for production (dedicated resources, backups, monitoring)
# Enable encryption at rest and network peering if possible
MONGODB_URI=mongodb+srv://<prod-user>:<password>@<prod-cluster>.mongodb.net/enterprise_rag?retryWrites=true&w=majority

# =============================================================================
# Redis Configuration (Managed - Production)
# =============================================================================
# Use production Redis with password, persistence, and replication
# Azure Cache for Redis Premium, AWS ElastiCache with auth
REDIS_URL=redis://:<password>@<prod-redis-host>:6380
REDIS_HOST=<prod-redis-host>
REDIS_PORT=6380

# =============================================================================
# Qdrant Configuration (Production)
# =============================================================================
# Use Qdrant Cloud or self-hosted cluster with API key authentication
QDRANT_URL=https://<cluster-id>.qdrant.io
QDRANT_API_KEY=
QDRANT_COLLECTION_NAME=documents

# =============================================================================
# Azure OpenAI Configuration (REQUIRED)
# =============================================================================
LLM_PROVIDER=azure_openai
EMBEDDING_PROVIDER=azure

AZURE_OPENAI_API_KEY=
AZURE_OPENAI_ENDPOINT=
AZURE_OPENAI_LLM_DEPLOYMENT=gpt-4o-mini
AZURE_OPENAI_EMBEDDING_DEPLOYMENT=text-embedding-3-small
AZURE_OPENAI_API_VERSION=2024-02-15-preview

# Production concurrency (match your Azure tier limits)
EMBEDDING_MAX_CONCURRENCY=10

# =============================================================================
# LLM Model Settings
# =============================================================================
LLM_MODEL=gpt-4o-mini
EMBEDDING_MODEL=text-embedding-3-small
JUDGE_LLM_MODEL=gpt-4o-mini
LLM_TEMPERATURE=0.3
LLM_MAX_TOKENS=2000
LLM_TOP_P=1
LLM_TOP_K=50

# =============================================================================
# Timeout Configuration
# =============================================================================
LLM_INVOKE_TIMEOUT=60000
LLM_STREAM_INITIAL_TIMEOUT=30000
LLM_STREAM_CHUNK_TIMEOUT=10000
REQUEST_TIMEOUT_MS=30000
STREAMING_TIMEOUT_MS=180000
SYNC_TIMEOUT_MS=600000
EMBEDDING_TIMEOUT_MS=120000

# =============================================================================
# JWT Authentication (REQUIRED - PRODUCTION SECRETS)
# =============================================================================
# CRITICAL: Generate unique, strong secrets for production
# Generate with: openssl rand -base64 48
JWT_ACCESS_SECRET=
JWT_REFRESH_SECRET=
JWT_ACCESS_EXPIRY=15m
JWT_REFRESH_EXPIRY=7d

# =============================================================================
# Encryption Key (REQUIRED - PRODUCTION KEY)
# =============================================================================
# CRITICAL: Generate unique, strong key for production
# Generate with: openssl rand -hex 32
# Store securely (e.g., Azure Key Vault, AWS Secrets Manager)
ENCRYPTION_KEY=
ENCRYPTION_KEY_VERSION=1

# =============================================================================
# Notion Integration
# =============================================================================
NOTION_CLIENT_ID=
NOTION_CLIENT_SECRET=
NOTION_REDIRECT_URI=https://devandre.sbs/api/v1/notion/callback
NOTION_WEBHOOK_SECRET=
NOTION_API_RATE_LIMIT=2

# =============================================================================
# Frontend URL (Production)
# =============================================================================
# CRITICAL: Restrict CORS to exact production domains only
FRONTEND_URL=https://devandre.sbs
ALLOWED_ORIGINS=https://devandre.sbs

# =============================================================================
# Logging (Production - Less verbose, no sensitive data)
# =============================================================================
LOG_LEVEL=info
LOG_RETRIEVAL_TRACE=false

# =============================================================================
# RAG Cache Configuration
# =============================================================================
RAG_CACHE_ENABLED=true
RAG_CACHE_TTL=3600

# =============================================================================
# Monitoring (Production)
# =============================================================================
LANGSMITH_API_KEY=
LANGSMITH_PROJECT=rag-notion-production
LANGSMITH_ENABLED=true

RAGAS_SERVICE_URL=http://ragas-service:8001
RAGAS_TIMEOUT=60000

# =============================================================================
# Email Configuration (Resend HTTP API)
# =============================================================================
# Uses Resend (HTTPS port 443) instead of SMTP to avoid DigitalOcean SMTP blocks
RESEND_API_KEY=
SMTP_FROM_NAME=RAG Platform
RESEND_FROM_EMAIL=noreply@devandre.sbs

# =============================================================================
# Security Settings (HARDENED)
# =============================================================================
ENFORCE_TENANT_ISOLATION=true

# Guardrails (Strict mode for production)
GUARDRAIL_STRICT_HALLUCINATION_BLOCKING=true
GUARDRAIL_HALLUCINATION_REQUIRE_BOTH=false
GUARDRAIL_USE_SEED_CRITICAL=true

# Brute Force Protection
AUTH_MAX_ATTEMPTS_IP=10
AUTH_MAX_ATTEMPTS_EMAIL=5
AUTH_ATTEMPT_WINDOW_SECONDS=900
AUTH_BLOCK_DURATION_SECONDS=3600

# =============================================================================
# Chunking Configuration
# =============================================================================
MAX_GROUP_TOKENS=400
MIN_GROUP_TOKENS=200
MIN_STANDALONE_TOKENS=50
MAX_LIST_ITEMS=15
EMBEDDING_CONTEXT_TOKENS=8192
ENABLE_CHUNK_FILTER=true
ENABLE_CODE_FILTER=true
USE_TIKTOKEN=false
PENDING_REINDEX=false

# =============================================================================
# Re-ranking
# =============================================================================
ENABLE_CROSS_ENCODER_RERANK=true
RERANK_PROVIDER=llm
RERANK_TOP_N=5
RERANK_MIN_SCORE=0.1
RERANK_TIMEOUT=10000
RERANK_CACHE_TTL=300

# =============================================================================
# Context Expansion
# =============================================================================
ENABLE_CONTEXT_EXPANSION=true
SIBLING_WINDOW_SIZE=1
MAX_CHUNKS_PER_SOURCE=5
MIN_SCORE_FOR_EXPANSION=0.5

# =============================================================================
# Sync & Recovery
# =============================================================================
STALE_JOB_TIMEOUT_HOURS=2
MAX_SYNC_RECOVERY_ATTEMPTS=2
SYNC_PROGRESS_TIMEOUT_MINUTES=30
NOTION_TOKEN_MONITOR_ENABLED=true
TOKEN_CHECK_INTERVAL_HOURS=6
NOTION_TOKEN_EMAIL_NOTIFICATIONS=true
