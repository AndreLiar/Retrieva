# =============================================================================
# Retrieva - STAGING Environment Configuration
# =============================================================================
# Copy this file to .env for staging deployments.
# Uses managed cloud services (MongoDB Atlas, etc.) with staging-specific settings.
# =============================================================================

# Server Configuration
PORT=3007
NODE_ENV=staging

# =============================================================================
# MongoDB Configuration (Atlas - Staging Cluster)
# =============================================================================
# Create a separate staging cluster in MongoDB Atlas
# Use M0 (free) or M2/M5 for staging to control costs
MONGODB_URI=mongodb+srv://<staging-user>:<password>@<staging-cluster>.mongodb.net/enterprise_rag_staging?retryWrites=true&w=majority

# =============================================================================
# Redis Configuration (Managed - Staging)
# =============================================================================
# Use a small Redis instance for staging (e.g., Azure Basic, AWS t3.micro)
REDIS_URL=redis://localhost:6378
REDIS_HOST=localhost
REDIS_PORT=6378

# =============================================================================
# Qdrant Configuration (Staging)
# =============================================================================
# Use Qdrant Cloud free tier or small instance for staging
QDRANT_URL=http://localhost:6333
QDRANT_COLLECTION_NAME=documents-staging

# =============================================================================
# Azure OpenAI Configuration (REQUIRED)
# =============================================================================
# Use same Azure OpenAI instance but consider rate limiting
LLM_PROVIDER=azure_openai
EMBEDDING_PROVIDER=azure

AZURE_OPENAI_API_KEY=
AZURE_OPENAI_ENDPOINT=
AZURE_OPENAI_LLM_DEPLOYMENT=gpt-4o-mini
AZURE_OPENAI_EMBEDDING_DEPLOYMENT=text-embedding-3-small
AZURE_OPENAI_API_VERSION=2024-02-15-preview

# Lower concurrency for staging to reduce costs
EMBEDDING_MAX_CONCURRENCY=5

# =============================================================================
# LLM Model Settings
# =============================================================================
LLM_MODEL=gpt-4o-mini
EMBEDDING_MODEL=text-embedding-3-small
JUDGE_LLM_MODEL=gpt-4o-mini
LLM_TEMPERATURE=0.3
LLM_MAX_TOKENS=2000
LLM_TOP_P=1
LLM_TOP_K=50

# =============================================================================
# Timeout Configuration
# =============================================================================
LLM_INVOKE_TIMEOUT=60000
LLM_STREAM_INITIAL_TIMEOUT=30000
LLM_STREAM_CHUNK_TIMEOUT=10000
REQUEST_TIMEOUT_MS=30000
STREAMING_TIMEOUT_MS=180000
SYNC_TIMEOUT_MS=600000
EMBEDDING_TIMEOUT_MS=120000

# =============================================================================
# JWT Authentication (REQUIRED - Generate unique secrets for staging)
# =============================================================================
# Generate with: openssl rand -base64 48
JWT_ACCESS_SECRET=
JWT_REFRESH_SECRET=
JWT_ACCESS_EXPIRY=15m
JWT_REFRESH_EXPIRY=7d

# =============================================================================
# Encryption Key (REQUIRED - Generate unique key for staging)
# =============================================================================
# Generate with: openssl rand -hex 32
ENCRYPTION_KEY=
ENCRYPTION_KEY_VERSION=1

# =============================================================================
# Notion Integration
# =============================================================================
# Use same OAuth app but with staging redirect URI
NOTION_CLIENT_ID=
NOTION_CLIENT_SECRET=
NOTION_REDIRECT_URI=https://staging.your-domain.com/api/v1/notion/callback
NOTION_WEBHOOK_SECRET=
NOTION_API_RATE_LIMIT=2

# =============================================================================
# Frontend URL (Staging)
# =============================================================================
FRONTEND_URL=https://staging.your-domain.com
ALLOWED_ORIGINS=https://staging.your-domain.com

# =============================================================================
# Logging (More verbose for staging debugging)
# =============================================================================
LOG_LEVEL=debug
LOG_RETRIEVAL_TRACE=true

# =============================================================================
# RAG Cache Configuration
# =============================================================================
RAG_CACHE_ENABLED=true
RAG_CACHE_TTL=1800  # Shorter TTL for staging (30 min)

# =============================================================================
# Monitoring (Enable for staging)
# =============================================================================
LANGSMITH_API_KEY=
LANGSMITH_PROJECT=rag-notion-staging
LANGSMITH_ENABLED=true

RAGAS_SERVICE_URL=http://localhost:8001
RAGAS_TIMEOUT=60000

# =============================================================================
# Security Settings
# =============================================================================
ENFORCE_TENANT_ISOLATION=true

# Guardrails
GUARDRAIL_STRICT_HALLUCINATION_BLOCKING=true
GUARDRAIL_HALLUCINATION_REQUIRE_BOTH=false

# =============================================================================
# Chunking Configuration
# =============================================================================
MAX_GROUP_TOKENS=400
MIN_GROUP_TOKENS=200
MIN_STANDALONE_TOKENS=50
MAX_LIST_ITEMS=15
EMBEDDING_CONTEXT_TOKENS=8192
ENABLE_CHUNK_FILTER=true
ENABLE_CODE_FILTER=true
USE_TIKTOKEN=false

# =============================================================================
# Re-ranking
# =============================================================================
ENABLE_CROSS_ENCODER_RERANK=true
RERANK_PROVIDER=llm
RERANK_TOP_N=5
RERANK_MIN_SCORE=0.1
RERANK_TIMEOUT=10000
RERANK_CACHE_TTL=300

# =============================================================================
# Context Expansion
# =============================================================================
ENABLE_CONTEXT_EXPANSION=true
SIBLING_WINDOW_SIZE=1
MAX_CHUNKS_PER_SOURCE=5
MIN_SCORE_FOR_EXPANSION=0.5

# =============================================================================
# Sync & Recovery
# =============================================================================
STALE_JOB_TIMEOUT_HOURS=2
MAX_SYNC_RECOVERY_ATTEMPTS=2
SYNC_PROGRESS_TIMEOUT_MINUTES=30
NOTION_TOKEN_MONITOR_ENABLED=true
TOKEN_CHECK_INTERVAL_HOURS=6
